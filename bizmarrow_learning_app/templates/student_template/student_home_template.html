{% extends 'student_template/base_template.html' %}
{% block page_title %}
Home
{% endblock page_title %}
{% block main_content %}
{% load embed_video_tags %}
{% load static %}
<section class="content">
  <div class="container-fluid">
    {% if class_room.count > 0 %}
    <div class="row">
      <div class="col-lg-12 form-group">
        {% for class_single in class_room %}
        <a href="/join_class_room/{{ class_single.subject.id }}/{{ class_single.session_years.id }}"
          class="btn btn-success">JOIN LIVE CLASS of {{ class_single.subject.subject_name }}</a>
        {% endfor %}
      </div>
    </div>
    {% endif %}




    <div class="row">
      <div class="col-xl-3 col-sm-6 col-12 d-flex">
        <div class="card w-100"
          style="background-color: rgb(88, 174, 231); border-radius: 10px; color: white; box-shadow: 2px 2px 4px black;">
          <div class="card-body">
            <div class="db-widgets d-flex justify-content-between align-items-center">
              <div class="db-icon" style="background-color: rgb(21, 94, 143)">
                <i class="fas fa-user-graduate"></i>
              </div>
              <div style="color: white;">
                <h3>{{ total_attendance }}</h3>
                <h6>Total Attendance</h6>
              </div>
            </div>
          </div>
          <a href="{% url 'student_view_attendance' %}" class="small-box-footer" style="color: white;">More info <i
              class="fas fa-arrow-circle-right"></i></a>
        </div>
      </div>

      <div class="col-xl-3 col-sm-6 col-12 d-flex">
        <div class="card w-100 bg-danger"
          style="border-radius: 10px; color: white; box-shadow: 2px 2px 4px black;">
          <div class="card-body">
            <div class="db-widgets d-flex justify-content-between align-items-center">
              <div class="db-icon" style="background-color: rgb(136, 13, 30)">
                <i class="fas fa-chalkboard-teacher"></i>
              </div>
              <div style="color: white;">
                <h3>{{ attendance_absent }}</h3>
                <h6>Absent</h6>
              </div>
            </div>
          </div>
          <a href="{% url 'student_view_attendance' %}" class="small-box-footer" style="color: white;">More info <i
              class="fas fa-arrow-circle-right"></i></a>
        </div>
      </div>

      <div class="col-xl-3 col-sm-6 col-12 d-flex">
        <div class="card w-100"
          style="background-color: rgb(88, 174, 231); border-radius: 10px; color: white; box-shadow: 2px 2px 4px black;">
          <div class="card-body">
            <div class="db-widgets d-flex justify-content-between align-items-center">
              <div class="db-icon" style="background-color: rgb(21, 94, 143)">
                <i class="fa-solid fa-book"></i>
              </div>
              <div style="color: white;">
                <h3>{{ attendance_present }}</h3>
                <h6>Present</h6>
              </div>
            </div>
          </div>
          <a href="{% url 'student_view_attendance' %}" class="small-box-footer" style="color: white;">More info <i
              class="fas fa-arrow-circle-right"></i></a>
        </div>
      </div>

      <div class="col-xl-3 col-sm-6 col-12 d-flex">
        <div class="card w-100 bg-danger"
          style="border-radius: 10px; color: white; box-shadow: 2px 2px 4px black;">
          <div class="card-body">
            <div class="db-widgets d-flex justify-content-between align-items-center">
              <div class="db-icon" style="background-color: rgb(136, 13, 30)">
                <i class="fas fa-book-reader"></i>
              </div>
              <div style="color: white;">
                <h3>{{ subjects }}</h3>
                <h6>Total Subjects</h6>
              </div>
            </div>
          </div>
          <i class="ion ion-pie-graph" style="color: white;"></i>
        </div>
      </div>

    </div>

    <!-- VIDEO SECTION -->
    <!-- <div class="row">
      <div class="col-lg-6">
        <div class="card card-success">
          <h3>List of Videos</h3>
          {% if form %}
          <ul>
            {% for video in form %}
            <li>
              <strong>{{ video.title }}</strong><br>
              Uploaded by: {{ video.sender }}<br>
              Description: {{ video.description }}<br>
              < Add other fields as needed -->
            <!-- </li> -->
            <!-- {% endfor %}
          </ul>
          {% else %}
          <p>No videos available.</p>
          {% endif %} -->

          <!-- {% if videoz %} -->
          <!-- <div class="mb-8">
                {% for x in videoz %}
                <div class="py-12 py-md-14 bg-cover rounded text-center"
                  style="background-image: url(https://plus.unsplash.com/premium_photo-1681628908641-64c458f24acd?q=80&w=1332&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D);">
                   Button -->
          <!-- <a href="{% video x.video %}"
                    class="btn h-90p w-90p rounded-circle btn-white size-30-all d-inline-flex align-items-center justify-content-center shadow lift text-dark"
                    data-fancybox> -->
          <!-- Icon -->
          <!-- <svg width="14" height="16" viewBox="0 0 14 16" xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M12.8704 6.15374L3.42038 0.328572C2.73669 -0.0923355 1.9101 -0.109836 1.20919 0.281759C0.508282 0.673291 0.0898438 1.38645 0.0898438 2.18929V13.7866C0.0898438 15.0005 1.06797 15.9934 2.27016 16C2.27344 16 2.27672 16 2.27994 16C2.65563 16 3.04713 15.8822 3.41279 15.6591C3.70694 15.4796 3.79991 15.0957 3.62044 14.8016C3.44098 14.5074 3.05697 14.4144 2.76291 14.5939C2.59188 14.6982 2.42485 14.7522 2.27688 14.7522C1.82328 14.7497 1.33763 14.3611 1.33763 13.7866V2.18933C1.33763 1.84492 1.51713 1.53907 1.81775 1.3711C2.11841 1.20314 2.47294 1.21064 2.76585 1.39098L12.2159 7.21615C12.4999 7.39102 12.6625 7.68262 12.6618 8.01618C12.6611 8.34971 12.4974 8.64065 12.2118 8.81493L5.37935 12.9983C5.08548 13.1783 4.9931 13.5623 5.17304 13.8562C5.35295 14.1501 5.73704 14.2424 6.03092 14.0625L12.8625 9.87962C13.5166 9.48059 13.9081 8.78496 13.9096 8.01868C13.9112 7.25249 13.5226 6.55524 12.8704 6.15374Z"
                        fill="currentColor" />
                    </svg>
                    <strong>{{ video.title }}</strong>
                    <p>Uploaded on: {{ video.publication_date }}</p>
                  </a>
                </div>
                {% endfor %}
              </div> -->
          <!-- {% else %}
              <p style="text-align: center;">No video uploaded yet.</p>
            {% endif %} -->
        </div>

      </div>
    </div> 
    <!-- Theme CSS -->
    <!-- <link rel="stylesheet" href="{% static 'assets/css/theme.min.css' %}"> -->



    <!-- <div class="row">
                  <div class="col-xl-3 col-sm-6 col-12 d-flex">
                    <div class="card bg-one w-100">
                        <div class="card-body">
                          <div class="db-widgets d-flex justify-content-between align-items-center">
                              <div class="db-icon">
                                <i class="ion ion-stats-bars" style=" color: white;"></i>
                              </div>
                              <div class="db-info">
                                <h3>{{ total_attendance }}</h3>
                                <h6>Total Attendance</h6>
                              </div>
                          </div>
                        </div>
                        <a href="{% url 'student_view_attendance' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                    </div>
                  </div>

                  <div class="col-xl-3 col-sm-6 col-12 d-flex">
                    <div class="card bg-two w-100">
                        <div class="card-body">
                          <div class="db-widgets d-flex justify-content-between align-items-center">
                              <div class="db-icon">
                                <i class="ion ion-stats-bars" style=" color: white;"></i>
                              </div>
                              <div class="db-info">
                                <h3>{{ attendance_absent }}</h3>
                                <h6>Absent</h6>
                              </div>
                          </div>
                          </div>
                          <a href="{% url 'student_view_attendance' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                    </div>
                  </div>
                  <div class="col-xl-3 col-sm-6 col-12 d-flex">
                    <div class="card bg-three w-100">
                        <div class="card-body">
                          <div class="db-widgets d-flex justify-content-between align-items-center">
                              <div class="db-icon">
                                <i class="fas fa-building"></i>
                              </div>
                              <div class="db-info">
                                <h3>{{ attendance_present }}</h3>
                                <h6>Present</h6>
                              </div>
                          </div>
                        </div>
                        <a href="{% url 'student_view_attendance' %}" class="small-box-footer" style="color: black;">More info <i class="fas fa-arrow-circle-right"></i></a>
                    </div>
                  </div>
                  <div class="col-xl-3 col-sm-6 col-12 d-flex">
                    <div class="card bg-four w-100">
                        <div class="card-body">
                          <div class="db-widgets d-flex justify-content-between align-items-center">
                              <div class="db-icon">
                                <i class="fas fa-file-invoice-dollar"></i>
                              </div>
                              <div class="db-info">
                                <h3>{{ subjects }}</h3>
                                <h6>Total Subjects</h6>
                              </div>
                          </div>
                        </div>
                        <i class="ion ion-pie-graph" style="color: white;"></i>
                    </div>
                  </div>
              </div> -->


    <!-- <div class="row">
      <div class="col-lg-6">
        <div class="card card-danger">
          <div class="card-header">
            <h3 class="card-title">Attendance Chart</h3>

            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
              </button>
              <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
            </div>
          </div>
          <div class="card-body">
            <canvas id="pieChart"
              style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
          </div>
        </div>

      </div>
      <div class="col-lg-6">
        <div class="card card-success">
          <div class="card-header">
            <h3 class="card-title">Attendance Statistics</h3>

            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
              </button>
              <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
            </div>
          </div>
          <div class="card-body">
            <div class="chart">
              <canvas id="barChart"
                style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
            </div>
          </div>

        </div>

      </div>
    </div> -->

  </div>
</section>
<!-- /.content -->
{% endblock main_content %}
{% block custom_js %}
<!-- <script>
  $(document).ready(function () {

    var subjects = {{ data_name| safe
  }};
  var data1 = {{ data1 }};
  var data2 = {{ data2 }};
  //Data Set for PIE CHart
  var pieData = {
    labels: [
      'ABSENT',
      'PRESENT',
      'TOTAL'
    ],
    datasets: [
      {
        data: [{{ attendance_absent }}, {{ attendance_present }}, {{ total_attendance }}],
  backgroundColor: ['#f56954', '#00a65a', '#ffc107'],
                }
              ]
            }


  //Data Set for Bar Chart
  var areaChartData = {
    labels: subjects,
    datasets: [
      {
        label: 'Present in Class',
        backgroundColor: 'rgba(60,141,188,0.9)',
        borderColor: 'rgba(60,141,188,0.8)',
        pointRadius: false,
        pointColor: '#3b8bba',
        pointStrokeColor: 'rgba(60,141,188,1)',
        pointHighlightFill: '#fff',
        pointHighlightStroke: 'rgba(60,141,188,1)',
        data: data1
      },
      {
        label: 'Absent in Class',
        backgroundColor: 'rgba(210, 214, 222, 1)',
        borderColor: 'rgba(210, 214, 222, 1)',
        pointRadius: false,
        pointColor: 'rgba(210, 214, 222, 1)',
        pointStrokeColor: '#c1c7d1',
        pointHighlightFill: '#fff',
        pointHighlightStroke: 'rgba(220,220,220,1)',
        data: data2
      },
    ]
  }


  var pieChartCanvas = $('#pieChart').get(0).getContext('2d')
  var pieOptions = {
    maintainAspectRatio: false,
    responsive: true,
  }
  //Create pie or douhnut chart
  // You can switch between pie and douhnut using the method below.
  var pieChart = new Chart(pieChartCanvas, {
    type: 'pie',
    data: pieData,
    options: pieOptions
  });


  var barChartCanvas = $('#barChart').get(0).getContext('2d')
  var barChartData = jQuery.extend(true, {}, areaChartData)
  var temp1 = areaChartData.datasets[0]
  barChartData.datasets[0] = temp1

  var barChartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    datasetFill: false
  }

  var barChart = new Chart(barChartCanvas, {
    type: 'bar',
    data: barChartData,
    options: barChartOptions
  })
    })
</script> -->
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-messaging.js"></script>
<script>
  var firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "FIREBASE_AUTH_URL",
    databaseURL: "FIREBASE_DATABASE_URL",
    projectId: "FIREBASE_PROJECT_ID",
    storageBucket: "FIREBASE_STORAGE_BUCKET_URL",
    messagingSenderId: "FIREBASE_SENDER_ID",
    appId: "FIREBASE_APP_ID",
    measurementId: "FIREBASE_MEASUREMENT_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const messaging = firebase.messaging();

  function IntitalizeFireBaseMessaging() {
    messaging
      .requestPermission()
      .then(function () {
        console.log("Notification Permission");
        return messaging.getToken();
      })
      .then(function (token) {
        console.log("Token : " + token);
        sendToServer(token);
      })
      .catch(function (reason) {
        console.log(reason);
      });
  }

  messaging.onMessage(function (payload) {
    console.log(payload);
    const notificationOption = {
      body: payload.notification.body,
      icon: payload.notification.icon
    };

    if (Notification.permission === "granted") {
      var notification = new Notification(payload.notification.title, notificationOption);

      notification.onclick = function (ev) {
        ev.preventDefault();
        window.open(payload.notification.click_action, '_blank');
        notification.close();
      }
    }

  });
  messaging.onTokenRefresh(function () {
    messaging.getToken()
      .then(function (newtoken) {
        console.log("New Token : " + newtoken);
        sendToServer(newtoken);
      })
      .catch(function (reason) {
        console.log(reason);
      })
  });

  function sendToServer(token) {
    $.ajax({
      url: "{% url 'student_fcmtoken_save' %}",
      type: 'POST',
      data: { token: token },
    })
      .done(function (response) {
        if (response == "True") {
          console.log("Token Save")
        }
        else {
          console.log("Error in Token Save")
        }
      });
  }
  IntitalizeFireBaseMessaging();
</script>
{% endblock custom_js %}